# 海洋热含量边界提取测试说明

## 测试脚本

`test_ocean_heat_extraction.py` - 验证海洋热含量边界局部化修复

## 快速运行

```bash
python3 test_ocean_heat_extraction.py
```

## 测试内容

该脚本测试3个真实台风案例，验证：

1. **边界范围**: 边界坐标是否在台风中心附近的合理范围内（≤12度）
2. **全球问题修复**: 边界不再跨越全球范围
3. **经度归一化**: 正确处理跨越日期变更线的情况
4. **中心对齐**: 边界中心距台风中心的偏移在合理范围内

## 测试案例

| 案例 | NC文件 | 追踪文件 | 台风中心 |
|------|--------|---------|---------|
| AURO | AURO_v100_IFS_2025061000_f000_f240_06.nc | track_2025162N15114_AURO_v100_IFS_2025061000_f000_f240_06.csv | 15.0°N, 113.9°E |
| FOUR | FOUR_v200_GFS_2020093012_f000_f240_06.nc | track_2020270N17159_FOUR_v200_GFS_2020093012_f000_f240_06.csv | 41.2°N, 166.3°E |
| PANG | PANG_v100_IFS_2022032900_f000_f240_06.nc | track_2022088N09116_PANG_v100_IFS_2022032900_f000_f240_06.csv | 9.4°N, 116.4°E |

## 输出文件

测试结果保存在 `data/testExtract/oceanHeat/` 目录：

- `data/testExtract/oceanHeat/test_ocean_heat_AURO.json`
- `data/testExtract/oceanHeat/test_ocean_heat_FOUR.json`
- `data/testExtract/oceanHeat/test_ocean_heat_PANG.json`

## 验证标准

✅ **通过标准**:
- 经度跨度 < 12°
- 纬度跨度 < 12°
- 边界中心距台风中心 < 10°

❌ **失败标准**:
- 经度或纬度跨度 > 50° (可能仍存在全局边界问题)

## 修复前后对比

### AURO案例

**修复前**:
```
经度范围: 0.00° - 227.75° (跨度 227.75°)
纬度范围: -25.25° - 64.00° (跨度 89.25°)
问题: 全球范围边界 ❌
```

**修复后**:
```
经度范围: 108.00° - 109.25° (跨度 1.25°)
纬度范围: 10.75° - 16.00° (跨度 5.25°)
边界类型: local_region
提取半径: 6.0度 ✅
```

## 技术细节

修复实现了以下改进：

1. **Haversine距离**: 使用球面距离而非平面距离
2. **圆形掩膜**: 基于真实距离创建圆形区域
3. **局部子域**: 只在台风中心附近提取等值线
4. **经度归一化**: 处理跨越日期变更线的情况
5. **元数据标注**: 明确标注边界类型和提取半径

详细技术文档见: `docs/OCEAN_HEAT_FIX_REPORT.md`
